<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AshaAI Assistant</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/11.6.1/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/11.6.1/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/11.6.1/firebase-functions-compat.js"></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
      :root {
        --primary-color: #4F46E5;
        --primary-hover: #4338CA;
        --secondary-color: #10B981;
        --tertiary-color: #F59E0B;
        --quaternary-color: #EF4444;
        --bg-color: #F9FAFB;
        --text-color: #1F2937;
        --light-gray: #F3F4F6;
        --dark-gray: #6B7280;
        --border-radius: 16px;
        --message-radius: 18px;
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        --vh: 1vh;
      }
      
      [data-theme="dark"] {
        --primary-color: #6366F1;
        --primary-hover: #818CF8;
        --bg-color: #111827;
        --text-color: #F9FAFB;
        --light-gray: #1F2937;
        --dark-gray: #9CA3AF;
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
      }
      
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      html, body {
        height: 100%;
        width: 100%;
        overflow: hidden;
      }
      
      body { 
        background: transparent; 
        color: var(--text-color); 
        font-family: var(--font-family);
        display: flex;
        flex-direction: column;
        transition: background-color 0.3s ease;
        position: relative;
      }
      
      header {
        background: var(--primary-color);
        backdrop-filter: blur(5px);
        color: white;
        padding: 16px;
        text-align: center;
        box-shadow: var(--shadow-md);
        position: relative;
        z-index: 10;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      h1 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
        letter-spacing: -0.025em;
      }
      
      .info-icon {
        width: 24px;
        height: 24px;
        margin-left: 8px;
        cursor: pointer;
        opacity: 0.9;
        transition: all 0.2s ease;
      }
      
      .info-icon:hover {
        opacity: 1;
        transform: scale(1.1);
      }
      
      .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        max-width: 100%;
        margin: 0 auto;
        position: relative;
        height: calc(100% - 60px);
        width: 100%;
        max-width: 768px;
        padding: 0 16px;
      }
      
      .messages-wrapper {
        flex: 1;
        overflow: hidden;
        position: relative;
        padding: 16px 0;
        backdrop-filter: blur(3px);
      }
      
      .messages {
        height: 100%;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding-right: 8px;
        scroll-behavior: smooth;
        -ms-overflow-style: none;  /* Internet Explorer and Edge */
        scrollbar-width: none;  /* Firefox */
        padding: 10px 0;
      }
      
      .messages::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera */
        width: 0;
        height: 0;
      }
      
      .messages::-webkit-scrollbar-track {
        display: none;
      }
      
      .messages::-webkit-scrollbar-thumb {
        display: none;
      }
      
      .message {
        max-width: 85%;
        padding: 16px 20px;
        border-radius: var(--message-radius);
        line-height: 1.6;
        word-wrap: break-word;
        animation: fadeIn 0.3s ease;
        font-size: 0.95rem;
        position: relative;
        margin-bottom: 8px;
      }
      
      .message p {
        margin: 0 0 12px 0;
      }
      
      .message p:last-child {
        margin-bottom: 0;
      }
      
      .message ul {
        margin: 8px 0;
        padding-left: 20px;
      }
      
      .message ul li {
        margin-bottom: 4px;
      }
      
      .message strong {
        font-weight: 600;
      }
      
      .message .copy-button {
        position: absolute;
        top: 12px;
        right: 12px;
        background-color: transparent;
        border: none;
        color: var(--dark-gray);
        opacity: 0;
        transition: opacity 0.2s ease, transform 0.2s ease;
        cursor: pointer;
        border-radius: 50%;
        padding: 4px;
        transform: scale(0.9);
        z-index: 2;
      }
      
      .message:hover .copy-button {
        opacity: 0.7;
      }
      
      .message .copy-button:hover {
        opacity: 1;
        transform: scale(1);
        background-color: rgba(0, 0, 0, 0.1);
      }
      
      .message .copy-button.copied {
        color: var(--secondary-color);
        opacity: 1;
      }
      
      [data-theme="dark"] .message .copy-button {
        color: rgba(255, 255, 255, 0.7);
      }
      
      [data-theme="dark"] .message .copy-button:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
      
      [data-theme="dark"] .message .copy-button.copied {
        color: var(--secondary-color);
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
      }
      
      @keyframes slideInRight {
        from { opacity: 0; transform: translateX(30px); }
        to { opacity: 1; transform: translateX(0); }
      }
      
      @keyframes slideInLeft {
        from { opacity: 0; transform: translateX(-30px); }
        to { opacity: 1; transform: translateX(0); }
      }
      
      @keyframes shimmer {
        0% { background-position: -468px 0; }
        100% { background-position: 468px 0; }
      }
      
      .user-message {
        align-self: flex-end;
        background: var(--primary-color);
        color: white;
        border-radius: var(--message-radius) var(--message-radius) 0 var(--message-radius);
        box-shadow: var(--shadow-sm);
        animation: slideInRight 0.3s ease-out;
      }
      
      .bot-message {
        align-self: flex-start;
        background: white;
        color: var(--text-color);
        border-radius: 0 var(--message-radius) var(--message-radius) var(--message-radius);
        box-shadow: var(--shadow-sm);
        animation: slideInLeft 0.3s ease-out;
      }
      
      .bot-message:first-child {
        border-radius: var(--message-radius);
      }
      
      .input-container {
        position: relative;
        padding: 16px 0 24px 0;
        background: linear-gradient(to top, rgba(249, 250, 251, 0.9) 80%, rgba(249, 250, 251, 0));
      }
      
      .input-area {
        display: flex;
        align-items: center;
        padding: 4px 8px 4px 16px;
        background: white;
        border-radius: 24px;
        box-shadow: var(--shadow-md);
        transition: box-shadow 0.3s ease;
      }
      
      .input-area:focus-within {
        box-shadow: 0 0 0 2px var(--primary-color), var(--shadow-md);
      }
      
      .input-actions {
        display: flex;
        align-items: center;
      }
      
      #user-input {
        flex: 1;
        border: none;
        outline: none;
        padding: 12px 0;
        font-size: 16px;
        font-family: inherit;
        background: transparent;
        color: var(--text-color);
      }
      
      #user-input::placeholder {
        color: var(--dark-gray);
        opacity: 0.7;
      }
      
      #voice-button {
        background: none;
        border: none;
        color: var(--dark-gray);
        width: 34px;
        height: 34px;
        cursor: pointer;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        margin-right: 4px;
      }
      
      #voice-button:hover {
        color: var(--primary-color);
        background-color: var(--light-gray);
      }
      
      #voice-button.listening {
        color: var(--quaternary-color);
        animation: pulse 1.5s infinite;
      }
      
      #send-button {
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        margin-left: 4px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        outline: none;
        position: relative;
        overflow: hidden;
      }
      
      #send-button:hover, #send-button:focus {
        background: var(--primary-hover);
        transform: scale(1.1);
      }
      
      #send-button:active {
        transform: scale(0.95);
      }
      
      #send-button.disabled {
        background: var(--dark-gray);
        cursor: not-allowed;
        transform: scale(1);
        opacity: 0.7;
      }
      
      #send-button.disabled:hover, #send-button.disabled:focus {
        background: var(--dark-gray);
        transform: scale(1);
      }
      
      #send-button::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%, -50%);
        transform-origin: 50% 50%;
      }
      
      #send-button:active::after {
        animation: ripple 0.6s ease-out;
      }
      
      @keyframes ripple {
        0% {
          transform: scale(0, 0) translate(-50%, -50%);
          opacity: 0.5;
        }
        100% {
          transform: scale(20, 20) translate(-50%, -50%);
          opacity: 0;
        }
      }
      
      .thinking {
        align-self: flex-start;
        background: var(--light-gray);
        color: var(--dark-gray);
        padding: 12px 16px;
        border-radius: 18px;
        display: none;
        font-size: 0.95rem;
      }
      
      .thinking.active {
        display: flex;
        align-items: center;
        animation: fadeIn 0.3s ease;
      }
      
      .dot-flashing {
        position: relative;
        width: 6px;
        height: 6px;
        border-radius: 5px;
        background-color: var(--dark-gray);
        color: var(--dark-gray);
        animation: dot-flashing 1s infinite linear alternate;
        animation-delay: 0.5s;
        margin: 0 0 0 8px;
      }
      
      .dot-flashing::before, .dot-flashing::after {
        content: '';
        display: inline-block;
        position: absolute;
        top: 0;
      }
      
      .dot-flashing::before {
        left: -10px;
        width: 6px;
        height: 6px;
        border-radius: 5px;
        background-color: var(--dark-gray);
        color: var(--dark-gray);
        animation: dot-flashing 1s infinite alternate;
        animation-delay: 0s;
      }
      
      .dot-flashing::after {
        left: 10px;
        width: 6px;
        height: 6px;
        border-radius: 5px;
        background-color: var(--dark-gray);
        color: var(--dark-gray);
        animation: dot-flashing 1s infinite alternate;
        animation-delay: 1s;
      }
      
      @keyframes dot-flashing {
        0% {
          background-color: var(--dark-gray);
        }
        50%, 100% {
          background-color: rgba(107, 114, 128, 0.2);
        }
      }
      
      /* Intro modal styles */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .overlay.active {
        opacity: 1;
        visibility: visible;
      }
      
      .intro-modal {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        max-width: 90%;
        width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
        position: relative;
        transform: translateY(20px);
        opacity: 0;
        transition: all 0.4s ease;
      }
      
      .overlay.active .intro-modal {
        transform: translateY(0);
        opacity: 1;
      }
      
      .modal-header {
        margin-bottom: 20px;
        text-align: center;
      }
      
      .modal-header h2 {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 8px;
      }
      
      .modal-header p {
        color: var(--dark-gray);
        font-size: 0.95rem;
      }
      
      .modal-content {
        margin-bottom: 24px;
      }
      
      .agent-diagram {
        width: 100%;
        padding: 20px;
        position: relative;
        margin: 20px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      
      .agent-box {
        background: white;
        padding: 12px 16px;
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        margin: 10px;
        text-align: center;
        width: 80%;
        max-width: 300px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
      }
      
      .agent-box.active {
        opacity: 1;
        transform: translateY(0);
      }
      
      .agent-box h3 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 6px;
      }
      
      .agent-box p {
        font-size: 14px;
        color: var(--dark-gray);
      }
      
      .agent-diagram-main {
        display: flex;
        width: 100%;
        justify-content: space-between;
        margin: 20px 0;
      }
      
      .agent-arrow {
        position: absolute;
        width: 40px;
        height: 20px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease;
      }
      
      .agent-arrow.active {
        opacity: 1;
        transform: translateY(0);
      }
      
      .close-modal {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        display: block;
        margin: 0 auto;
        transition: all 0.2s ease;
      }
      
      .close-modal:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
      }
      
      .close-modal:active {
        transform: translateY(0);
      }
      
      /* Agent info tooltip */
      .agent-info {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.9);
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-lg);
        z-index: 100;
        max-width: 90%;
        width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .agent-info.active {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1);
      }
      
      .agent-info-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .agent-info-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      
      .agent-info h3 {
        color: var(--primary-color);
        margin-bottom: 12px;
        font-size: 20px;
      }
      
      .agent-info-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: var(--dark-gray);
      }
      
      /* Agent info specific styles */
      .agent-info .agent-diagram {
        padding: 10px 0;
        margin: 10px 0;
      }
      
      .agent-info .agent-box {
        padding: 8px 12px;
        margin: 6px auto;
        width: 90%;
      }
      
      .agent-info .agent-box h3 {
        font-size: 14px;
        margin-bottom: 4px;
      }
      
      .agent-info .agent-box p {
        font-size: 12px;
        margin: 0;
      }
      
      .agent-info .agent-diagram-main {
        flex-wrap: wrap;
        justify-content: center;
        gap: 5px;
        margin: 10px 0;
      }
      
      .agent-info .agent-diagram-main .agent-box {
        width: 45%;
        min-width: 120px;
      }
      
      /* Responsive adjustments */
      @media (max-width: 640px) {
        .chat-container {
          padding: 0 12px;
        }
        
        .message {
          max-width: 90%;
          font-size: 0.9rem;
        }
        
        h1 {
          font-size: 18px;
        }
        
        .messages-wrapper {
          padding: 12px 0;
        }
        
        .input-area {
          padding: 2px 4px 2px 12px;
        }
        
        #user-input {
          padding: 10px 0;
          font-size: 15px;
        }
        
        .agent-diagram-main {
          flex-direction: column;
          align-items: center;
        }
        
        .agent-info {
          max-height: 80vh;
          width: 95%;
          overflow-y: auto;
        }
        
        .agent-box {
          width: 90%;
          margin: 8px auto;
        }
        
        .suggestions-toggle {
          width: 32px;
          height: 32px;
          padding: 6px;
          background-color: rgba(79, 70, 229, 0.1);
        }
      }
      
      @media (min-width: 1024px) {
        .chat-container {
          max-width: 800px;
        }
        
        .message {
          max-width: 75%;
        }
        
        .agent-info {
          max-height: 85vh;
          width: 450px;
          overflow-y: auto;
        }
      }
      
      /* Add new styles for the theme toggle and dark mode elements */
      .actions-container {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      
      .theme-toggle {
        background: none;
        border: none;
        padding: 4px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }
      
      .theme-toggle:hover {
        background-color: rgba(255, 255, 255, 0.2);
        transform: scale(1.1);
      }
      
      [data-theme="dark"] .user-message {
        background: var(--primary-color);
      }
      
      [data-theme="dark"] .bot-message {
        background: var(--light-gray);
        color: var(--text-color);
      }
      
      [data-theme="dark"] .thinking {
        background: #2D3748;
      }
      
      [data-theme="dark"] .input-area {
        background: var(--light-gray);
      }
      
      [data-theme="dark"] #user-input {
        color: var(--text-color);
      }
      
      [data-theme="dark"] #user-input::placeholder {
        color: var(--dark-gray);
      }
      
      [data-theme="dark"] .agent-info,
      [data-theme="dark"] .intro-modal {
        background: var(--light-gray);
        color: var(--text-color);
      }
      
      [data-theme="dark"] .agent-box {
        background: #2D3748;
      }
      
      [data-theme="dark"] .agent-info h3,
      [data-theme="dark"] .intro-modal h2 {
        color: var(--primary-color);
      }
      
      @media (prefers-color-scheme: dark) {
        :root:not([data-theme="light"]) {
          --primary-color: #6366F1;
          --primary-hover: #818CF8;
          --bg-color: #111827;
          --text-color: #F9FAFB;
          --light-gray: #1F2937;
          --dark-gray: #9CA3AF;
          --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
          --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
          --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }
        
        .theme-light-icon {
          display: none;
        }
        
        .theme-dark-icon {
          display: block !important;
        }
      }
      
      /* Add loading animation for new messages */
      .message.loading {
        position: relative;
        overflow: hidden;
      }
      
      .message.loading::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: linear-gradient(to right, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 0.3) 50%, rgba(255, 255, 255, 0) 100%);
        background-size: 468px 100%;
        animation: shimmer 1.5s infinite linear;
      }
      
      /* Add styling for suggestion chips */
      .suggestions {
        padding: 12px 0;
        opacity: 1;
        transition: opacity 0.3s ease, transform 0.3s ease;
        position: relative;
      }
      
      .suggestions.hidden {
        opacity: 0;
        transform: translateY(10px);
        pointer-events: none;
      }
      
      .suggestions.collapsed {
        max-height: 40px;
        overflow: hidden;
      }
      
      .suggestions-label {
        font-size: 0.85rem;
        color: var(--dark-gray);
        margin-bottom: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      
      .suggestions-toggle {
        background: none;
        border: none;
        color: var(--primary-color);
        cursor: pointer;
        padding: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        transition: all 0.2s ease;
        z-index: 2;
      }
      
      .suggestions-toggle:hover {
        background-color: rgba(79, 70, 229, 0.1);
      }
      
      .suggestions-toggle svg {
        transition: transform 0.3s ease;
      }
      
      .suggestions.collapsed .suggestions-toggle svg {
        transform: rotate(180deg);
      }
      
      .suggestions-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 8px;
      }
      
      .suggestion-chip {
        background: white;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
        border-radius: 16px;
        padding: 6px 12px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.2s ease;
        animation: fadeIn 0.4s ease-out;
        animation-fill-mode: both;
      }
      
      .suggestion-chip:hover {
        background: var(--primary-color);
        color: white;
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
      }
      
      .suggestion-chip:active {
        transform: translateY(0);
      }
      
      /* Dark mode styling for suggestion chips */
      [data-theme="dark"] .suggestion-chip {
        background: var(--light-gray);
        color: var(--primary-color);
      }
      
      [data-theme="dark"] .suggestion-chip:hover {
        background: var(--primary-color);
        color: white;
      }
      
      /* Particles background styling */
      .particles-container {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -1;
        overflow: hidden;
      }
      
      [data-theme="dark"] .particles-container {
        background-color: var(--bg-color);
      }
      
      /* Adjust existing styles to work with particles */
      header {
        background: var(--primary-color);
        backdrop-filter: blur(5px);
      }
      
      .input-container {
        background: linear-gradient(to top, rgba(249, 250, 251, 0.9) 80%, rgba(249, 250, 251, 0));
      }
      
      [data-theme="dark"] .input-container {
        background: linear-gradient(to top, rgba(17, 24, 39, 0.9) 80%, rgba(17, 24, 39, 0));
      }
    </style>
  </head>
  <body>
    <div class="particles-container" id="particles-js"></div>
    
    <header>
      <h1>AshaAI Assistant</h1>
      <div class="actions-container">
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark mode">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="20" height="20" class="theme-light-icon">
            <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z" />
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="20" height="20" class="theme-dark-icon" style="display: none;">
            <path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z" clip-rule="evenodd" />
          </svg>
        </button>
        <div class="info-icon" id="info-button">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="24" height="24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
          </svg>
    </div>
      </div>
    </header>
    
    <div class="chat-container">
      <div class="messages-wrapper">
        <div class="messages" id="messages">
          <div class="message bot-message">
            Hello! I'm AshaAI. How can I help you today?
          </div>
        </div>
      </div>
      
      <div class="thinking" id="thinking">
        <span>AshaAI is thinking</span>
        <div class="dot-flashing"></div>
      </div>
      
      <div class="suggestions" id="suggestions-container">
        <div class="suggestions-label">
          <span>Try asking:</span>
          <button class="suggestions-toggle" id="suggestions-toggle" aria-label="Toggle suggestions">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
        <div class="suggestions-list" id="suggestions-list">
          <!-- Suggestion chips will be added here -->
        </div>
      </div>
      
      <div class="input-container">
        <div class="input-area">
          <input type="text" id="user-input" placeholder="Type your message here..." />
          <div class="input-actions">
            <button id="voice-button" aria-label="Voice input">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                <line x1="12" y1="19" x2="12" y2="23"></line>
                <line x1="8" y1="23" x2="16" y2="23"></line>
              </svg>
            </button>
            <button id="send-button" aria-label="Send message">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M2.01 21L23 12 2.01 3 2 10L17 12 2 14L2.01 21Z" fill="white"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Agent Information Overlay -->
    <div class="agent-info-overlay" id="agent-info-overlay"></div>
    <div class="agent-info" id="agent-info">
      <button class="agent-info-close" id="agent-info-close">&times;</button>
      <h3>AshaAI Architecture</h3>
      <p>AshaAI uses an advanced multi-agent architecture powered by Google ADK and Gemini:</p>
      <div class="agent-diagram">
        <div class="agent-box" style="background-color: #F3F4F6;">
          <h3>User Input</h3>
          <p>Your messages and requests</p>
        </div>
        <div class="agent-box" style="background-color: #E0F2FE;">
          <h3>Security Agent</h3>
          <p>Checks for security issues, bias, or sensitive content</p>
        </div>
        <div class="agent-box" style="background-color: #DBEAFE;">
          <h3>Router Agent</h3>
          <p>Decides which specialized agent to use based on your query</p>
        </div>
        <div class="agent-diagram-main">
          <div class="agent-box" style="background-color: #E0F2FE;">
            <h3>Job Search Agent</h3>
            <p>Finds job listings using local DB and web searches</p>
          </div>
          <div class="agent-box" style="background-color: #FEF3C7;">
            <h3>Event Search Agent</h3>
            <p>Searches for relevant events and meetups</p>
          </div>
          <div class="agent-box" style="background-color: #E0F2FE;">
            <h3>Mentorship Search Agent</h3>
            <p>Finds mentorship opportunities</p>
          </div>
        </div>
        <div class="agent-box" style="background-color: #DBEAFE;">
          <h3>Response</h3>
          <p>The final answer crafted for you</p>
        </div>
      </div>
      <p>This workflow is built with Google ADK and Gemini to deliver accurate, helpful responses to your questions.</p>
    </div>

    <!-- Introduction Modal -->
    <div class="overlay" id="intro-overlay">
      <div class="intro-modal">
        <div class="modal-header">
          <h2>Welcome to AshaAI</h2>
          <p>Your intelligent assistant powered by advanced AI technology</p>
        </div>
        <div class="modal-content">
          <p>AshaAI is built using a multi-agent architecture that allows it to handle a variety of tasks efficiently.</p>
          
          <div class="agent-diagram">
            <div class="agent-box" id="intro-user">
              <h3>User Input</h3>
              <p>Your messages and requests</p>
            </div>
            
            <svg class="agent-arrow" id="arrow1" width="20" height="40" viewBox="0 0 20 40" fill="none" xmlns="http://www.w3.org/2000/svg" style="top: 80px; left: 50%; transform: translateX(-50%);">
              <path d="M10 0L10 35M10 35L1 26M10 35L19 26" stroke="#6B7280" stroke-width="2"/>
            </svg>
            
            <div class="agent-box" id="intro-security" style="background-color: #E0F2FE;">
              <h3>Security Agent</h3>
              <p>Checks for security issues, bias, or sensitive content</p>
            </div>
            
            <svg class="agent-arrow" id="arrow2" width="20" height="40" viewBox="0 0 20 40" fill="none" xmlns="http://www.w3.org/2000/svg" style="top: 180px; left: 50%; transform: translateX(-50%);">
              <path d="M10 0L10 35M10 35L1 26M10 35L19 26" stroke="#6B7280" stroke-width="2"/>
            </svg>
            
            <div class="agent-box" id="intro-router" style="background-color: #DBEAFE;">
              <h3>Router Agent</h3>
              <p>Decides which specialized agent to use based on your query</p>
            </div>
            
            <div class="agent-diagram-main" id="specialized-agents">
              <div class="agent-box" id="intro-job" style="background-color: #E0F2FE;">
                <h3>Job Search Agent</h3>
                <p>Finds job listings using local DB and web searches</p>
              </div>
              
              <div class="agent-box" id="intro-event" style="background-color: #FEF3C7;">
                <h3>Event Search Agent</h3>
                <p>Searches for relevant events and meetups</p>
              </div>
              
              <div class="agent-box" id="intro-mentor" style="background-color: #E0F2FE;">
                <h3>Mentorship Search Agent</h3>
                <p>Finds mentorship opportunities</p>
              </div>
            </div>
            
            <svg class="agent-arrow" id="arrow3" width="20" height="40" viewBox="0 0 20 40" fill="none" xmlns="http://www.w3.org/2000/svg" style="bottom: 100px; left: 50%; transform: translateX(-50%);">
              <path d="M10 0L10 35M10 35L1 26M10 35L19 26" stroke="#6B7280" stroke-width="2"/>
            </svg>
            
            <div class="agent-box" id="intro-response" style="background-color: #DBEAFE;">
              <h3>Response</h3>
              <p>The final answer crafted for you</p>
            </div>
          </div>
          
          <p>This workflow is built with Google ADK and Gemini to deliver accurate, helpful responses to your questions.</p>
        </div>
        <button class="close-modal" id="close-intro">Got it!</button>
      </div>
    </div>

    <!-- Add Particles.js for the background -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const messagesContainer = document.getElementById('messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const voiceButton = document.getElementById('voice-button');
        const thinking = document.getElementById('thinking');
        const introOverlay = document.getElementById('intro-overlay');
        const closeIntro = document.getElementById('close-intro');
        const infoButton = document.getElementById('info-button');
        const agentInfo = document.getElementById('agent-info');
        const agentInfoOverlay = document.getElementById('agent-info-overlay');
        const agentInfoClose = document.getElementById('agent-info-close');
        const suggestionsContainer = document.getElementById('suggestions-container');
        const suggestionsList = document.getElementById('suggestions-list');
        const suggestionsToggle = document.getElementById('suggestions-toggle');
        
        // Fix for agent-info - make sure all boxed are visible
        const agentInfoBoxes = agentInfo.querySelectorAll('.agent-box');
        agentInfoBoxes.forEach(box => {
          box.style.opacity = 1;
          box.style.transform = 'translateY(0)';
        });
        
        // Common queries database - respond locally without backend call
        const commonResponses = {
          // Basic greetings
          "hi": "Hello! I'm AshaAI. How can I help you today?",
          "hello": "Hi there! I'm AshaAI, your AI assistant. What can I do for you?",
          "hey": "Hey! I'm AshaAI. What can I help you with today?",
          "good morning": "Good morning! Hope you're having a great start to your day. How can I assist you?",
          "good afternoon": "Good afternoon! How can I be of service today?",
          "good evening": "Good evening! How may I assist you tonight?",
          
          // About AshaAI
          "who are you": "I'm AshaAI, an intelligent assistant powered by Google ADK and Gemini. I can help with searches, answer questions, and perform calculations. My architecture uses a multi-agent system that routes your questions to specialized sub-agents for the best response.",
          "what is your name": "My name is AshaAI. I'm your AI assistant designed to help with various tasks!",
          "what can you do": "I can help with several things using my multi-agent architecture: search for information on the web, answer general knowledge questions, make calculations, and have conversations. Just ask me anything, and I'll do my best to assist you!",
          "how do you work": "I work using a sophisticated multi-agent architecture powered by Google ADK and Gemini. When you ask a question, my coordinator agent routes it to specialized sub-agents: a greeter for conversations, a search agent for factual information, or a calculator agent for math problems. This helps me provide accurate and helpful responses.",
          "what's your purpose": "My purpose is to assist you with finding information, answering questions, and having helpful conversations. I'm designed to be your AI companion for knowledge and assistance.",
          
          // Help and assistance
          "help": "I can help you find information, answer questions, or just chat. Try asking me about a topic you're interested in, or ask me to calculate something for you.",
          "commands": "I can understand natural language, so you don't need specific commands! Just ask your question normally, and I'll do my best to help. Try asking about job opportunities, events, or mentorship programs.",
          "features": "I have several features including job search assistance, event recommendations, mentorship connections, and general information lookup. What would you like to know more about?",
          
          // Job search related
          "find me a job": "I'd be happy to help you find a job! To give you the best recommendations, could you tell me a bit more about your skills, experience level, and what kind of position you're looking for?",
          "job search": "Looking for a job? I can help with that! What industry are you interested in, and what's your experience level?",
          "career advice": "Finding the right career path is important! I'd suggest starting by identifying your strengths and interests. Then, research industries and roles that align with those. Would you like specific advice about a particular career or industry?",
          "resume tips": "When creating a strong resume, focus on highlighting your achievements with quantifiable results, customize it for each job application, keep it concise (1-2 pages), use keywords from the job description, and proofread carefully. Would you like more specific resume advice?",
          "interview tips": "For successful interviews: research the company beforehand, prepare answers to common questions, bring specific examples of your work, dress professionally, arrive early, ask thoughtful questions, and follow up with a thank-you note. Is there a specific part of interviewing you'd like help with?",
          
          // Events and networking
          "networking events": "Networking is crucial for professional growth! I can help you find events in your industry. What field are you interested in, and what's your location?",
          "find events": "I'd be happy to help you find events! Could you specify what type of events you're interested in (professional, educational, social) and your location?",
          "meetups": "Meetups are a great way to connect with like-minded people! To help you find relevant meetups, could you tell me your interests and location?",
          
          // Mentorship
          "find a mentor": "Finding a mentor can be transformative for your career! To help match you with the right mentor, could you share your field of interest, career stage, and what you hope to gain from mentorship?",
          "become a mentor": "That's wonderful that you want to become a mentor! Your experience can be invaluable to others. Would you like information on mentorship programs or best practices for effective mentoring?",
          "mentorship benefits": "Mentorship offers numerous benefits: accelerated learning, expanded professional networks, increased confidence, enhanced career development, and personal growth. Both mentors and mentees benefit from the relationship. Would you like more specific information about mentorship?",
          
          // Education and learning
          "online courses": "Online courses are a great way to build new skills! Popular platforms include Coursera, Udemy, edX, and LinkedIn Learning. What subject are you interested in learning?",
          "learning resources": "There are many excellent learning resources available online. From structured courses to tutorial videos to interactive coding platforms. What specific skill or subject are you trying to learn?",
          "skill development": "Developing new skills is essential in today's rapidly changing job market. The most in-demand skills currently include data analysis, digital marketing, programming, AI/ML knowledge, and soft skills like communication and adaptability. Which area interests you most?",
          
          // General knowledge
          "what is ai": "Artificial Intelligence (AI) refers to systems or machines that mimic human intelligence to perform tasks and can iteratively improve themselves based on the information they collect. AI encompasses various technologies including machine learning, natural language processing, computer vision, and robotics. It's being applied across industries to automate processes, gain insights from data, and create new capabilities.",
          "what is machine learning": "Machine Learning is a subset of artificial intelligence that enables systems to learn and improve from experience without being explicitly programmed. It uses algorithms to analyze data, learn from it, and make predictions or decisions. Types of machine learning include supervised learning (trained on labeled data), unsupervised learning (finds patterns in unlabeled data), and reinforcement learning (learns through trial and error).",
          
          // Pleasantries
          "thanks": "You're welcome! If you need anything else, just ask.",
          "thank you": "You're welcome! I'm happy to help.",
          "good job": "Thank you! I'm glad I could assist you. Is there anything else you'd like help with?",
          "bye": "Goodbye! Feel free to come back anytime you need assistance.",
          "goodbye": "Farewell! Have a wonderful day. I'll be here if you need help in the future.",
          
          // Fun and personal
          "tell me a joke": "Why don't scientists trust atoms? Because they make up everything!",
          "another joke": "Why did the scarecrow win an award? Because he was outstanding in his field!",
          "fun fact": "Here's a fun fact: Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still perfectly good to eat!",
          "motivational quote": "Here's some motivation for you: 'The future depends on what you do today.' - Mahatma Gandhi",
          
          // Weather related (placeholder - would need API integration for real data)
          "weather": "I don't currently have access to real-time weather data. To check the weather, you could use a weather app or website like Weather.com or AccuWeather.",
          
          // Easter eggs
          "do you dream": "That's a fascinating philosophical question! While I don't dream like humans do, I was trained on vast amounts of data and patterns. You could say my 'dreams' are the associations and connections I've learned during my training.",
          "are you human": "No, I'm not human. I'm an AI assistant designed to be helpful, harmless, and honest. I don't have consciousness or feelings, but I aim to provide useful and thoughtful responses to your questions.",
          "meaning of life": "The meaning of life is a profound philosophical question that humans have pondered for centuries. Different philosophers and traditions offer various perspectives. Some find meaning in happiness, others in service to others, personal growth, or spiritual fulfillment. What gives your life meaning is ultimately a personal journey of discovery.",
        };
        
        // Function to find the best matching response from common queries
        function findBestResponse(query) {
          // Normalize the query
          const normalizedQuery = query.toLowerCase().trim();
          
          // Direct match
          if (commonResponses[normalizedQuery]) {
            return commonResponses[normalizedQuery];
          }
          
          // Partial match - check if query contains any of the keys
          for (const [key, response] of Object.entries(commonResponses)) {
            if (normalizedQuery.includes(key) || key.includes(normalizedQuery)) {
              return response;
            }
          }
          
          // No match found
          return null;
        }
        
        // Check if this is the first visit
        const isFirstVisit = !localStorage.getItem('ashaai_visited');
        
        // Function to add a message to the chat with animations
        function addMessage(text, isUser) {
          const messageDiv = document.createElement('div');
          messageDiv.className = isUser ? 'message user-message' : 'message bot-message loading';
          
          // Add original text as data attribute for copying later
          if (!isUser) {
            messageDiv.setAttribute('data-original-text', text);
          }
          
          // For user messages, simply set the text content
          if (isUser) {
            messageDiv.textContent = text;
            messagesContainer.appendChild(messageDiv);
            smoothScrollToBottom();
            return;
          }
          
          // For bot messages, we need to handle Markdown and add the copy button
          messagesContainer.appendChild(messageDiv);
          
          // Create copy button
          const copyButton = document.createElement('button');
          copyButton.className = 'copy-button';
          copyButton.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
          copyButton.setAttribute('aria-label', 'Copy to clipboard');
          copyButton.setAttribute('title', 'Copy to clipboard');
          
          // Add click event for copying
          copyButton.addEventListener('click', function() {
            const originalText = this.parentNode.getAttribute('data-original-text');
            navigator.clipboard.writeText(originalText).then(() => {
              this.classList.add('copied');
              this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>';
              
              setTimeout(() => {
                this.classList.remove('copied');
                this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>';
              }, 2000);
            });
          });
          
          messageDiv.appendChild(copyButton);
          
          // Function to convert markdown to HTML
          function markdownToHtml(text) {
            // Handle bold text (**text**)
            let html = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            // Handle bullet points
            html = html.replace(/^\s*\*\s+(.*?)$/gm, '<li>$1</li>');
            html = html.replace(/<li>(.*?)<\/li>/g, '<ul><li>$1</li></ul>');
            html = html.replace(/<\/ul>\s*<ul>/g, '');
            
            // Handle line breaks and paragraphs
            html = html.replace(/\n\n/g, '</p><p>');
            html = html.replace(/\n/g, '<br>');
            
            // Wrap in paragraph if not already
            if (!html.startsWith('<p>')) {
              html = '<p>' + html + '</p>';
            }
            
            return html;
          }
          
          // Disable send button during typing
          const sendButton = document.getElementById('send-button');
          const userInput = document.getElementById('user-input');
          sendButton.classList.add('disabled');
          sendButton.disabled = true;
          userInput.disabled = true;
          
          // Start typing animation with a short delay
          setTimeout(() => {
            // Remove loading class
            messageDiv.classList.remove('loading');
            
            // Convert markdown to HTML
            const htmlContent = markdownToHtml(text);
            
            // Set up the typewriter effect
            let visibleContent = '';
            let contentWithoutTags = htmlContent.replace(/<[^>]*>/g, '');
            let tagStack = [];
            let currentTagBuffer = '';
            let inTag = false;
            let i = 0;
            let contentIndex = 0;
            
            // Use a faster typing speed
            const typingSpeed = 8; // ms per character
            
            function typeNextChar() {
              if (i < htmlContent.length) {
                const char = htmlContent[i];
                
                // Handle HTML tags
                if (char === '<') {
                  inTag = true;
                  currentTagBuffer = '<';
                } else if (inTag && char === '>') {
                  inTag = false;
                  currentTagBuffer += '>';
                  
                  // Check if it's a closing tag
                  if (currentTagBuffer.indexOf('</') === 0) {
                    tagStack.pop(); // Remove the last opening tag
                  } else if (!currentTagBuffer.endsWith('/>')) {
                    // If not a self-closing tag, add to stack
                    tagStack.push(currentTagBuffer);
                  }
                  
                  visibleContent += currentTagBuffer;
                  currentTagBuffer = '';
                } else if (inTag) {
                  currentTagBuffer += char;
                } else {
                  // Regular character, not part of a tag
                  visibleContent += char;
                  contentIndex++;
                }
                
                i++;
                
                // Update the HTML content
                messageDiv.innerHTML = visibleContent;
                
                // Make sure copy button stays
                if (messageDiv.querySelector('.copy-button') === null) {
                  messageDiv.appendChild(copyButton);
                }
                
                // Auto scroll if near bottom
                const isNearBottom = messagesContainer.scrollHeight - messagesContainer.scrollTop - messagesContainer.clientHeight < 100;
                if (isNearBottom) {
                  messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
                
                // Continue typing with a small random delay for more natural effect
                const randomVariation = Math.random() * 5;
                setTimeout(typeNextChar, typingSpeed + randomVariation);
              } else {
                // Finished typing
                // Make sure all tags are properly closed
                while (tagStack.length > 0) {
                  const tag = tagStack.pop();
                  const tagName = tag.match(/<([a-z0-9]+)[\s>]/i)[1];
                  visibleContent += `</${tagName}>`;
                }
                
                // Final update
                messageDiv.innerHTML = visibleContent;
                
                // Make sure copy button is still there
                if (messageDiv.querySelector('.copy-button') === null) {
                  messageDiv.appendChild(copyButton);
                }
                
                // Final scroll to bottom
                smoothScrollToBottom();
                
                // Re-enable send button after typing is complete
                sendButton.classList.remove('disabled');
                sendButton.disabled = false;
                userInput.disabled = false;
                userInput.focus();
              }
            }
            
            // Start the typing animation
            typeNextChar();
            
          }, 300);
        }
        
        // Smooth scrolling function for better UX
        function smoothScrollToBottom() {
          messagesContainer.scrollTo({
            top: messagesContainer.scrollHeight,
            behavior: 'smooth'
          });
        }
        
        // Function to scroll to the bottom of the messages
        function scrollToBottom() {
          messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // Suggested queries for better UX
        const suggestedQueries = [
          { text: "Find me a job", delay: 300 },
          { text: "Upcoming tech events", delay: 400 },
          { text: "Find a mentor", delay: 500 },
          { text: "Career advice", delay: 600 },
          { text: "Resume tips", delay: 700 },
          { text: "What can you do?", delay: 800 }
        ];
        
        // Function to display suggested queries
        function showSuggestions() {
          // Clear any existing suggestions
          suggestionsList.innerHTML = '';
          
          // Add each suggestion with a slight delay for animation
          suggestedQueries.forEach((suggestion, index) => {
            const chip = document.createElement('div');
            chip.className = 'suggestion-chip';
            chip.textContent = suggestion.text;
            chip.style.animationDelay = `${suggestion.delay}ms`;
            
            chip.addEventListener('click', () => {
              userInput.value = suggestion.text;
              sendMessage();
              
              // Hide suggestions after clicking
              suggestionsContainer.classList.add('hidden');
            });
            
            suggestionsList.appendChild(chip);
          });
          
          // Show the suggestions container
          suggestionsContainer.classList.remove('hidden');
        }
        
        // Show suggestions when the page loads
        showSuggestions();
        
        // Function to call the Firebase function
        function callAgentFunction(query) {
          // Hide suggestions when a message is sent
          suggestionsContainer.classList.add('hidden');
          
          // Disable send button during processing
          const sendButton = document.getElementById('send-button');
          const userInput = document.getElementById('user-input');
          sendButton.classList.add('disabled');
          sendButton.disabled = true;
          userInput.disabled = true;
          
          // All queries go directly to the backend - no local responses
          thinking.classList.add('active');
          scrollToBottom();
          
          // Always use the production URL
          fetch('https://ashaai2-agent-jllcirxkfq-uc.a.run.app', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ query: query })
          })
          .then(response => {
            // Check the content type to determine how to parse the response
            const contentType = response.headers.get('content-type');
            if (contentType && contentType.includes('application/json')) {
              return response.json().then(data => ({ isJson: true, data }));
            } else {
              return response.text().then(text => ({ isJson: false, data: text }));
            }
          })
          .then(({ isJson, data }) => {
            // Hide typing indicator
            thinking.classList.remove('active');
            
            let responseText = '';
            
            if (!isJson) {
              // Direct text response
              responseText = data;
            } else {
              // JSON response handling
              if (typeof data === 'string') {
                responseText = data;
              } else if (data.response) {
                responseText = data.response;
              } else if (data.result) {
                responseText = data.result;
              } else {
                // If we can't find a specific field, stringify the entire response
                const stringified = JSON.stringify(data);
                responseText = stringified.length < 10000 ? stringified : "Received a response but couldn't parse it properly.";
              }
            }
            
            console.log("API Response:", data);
            addMessage(responseText, false);
            
            // Show new suggestions after a response
            setTimeout(showSuggestions, 1000);
          })
          .catch(error => {
            // Hide typing indicator
            thinking.classList.remove('active');
            console.error("API Error:", error);
            addMessage("Sorry, there was an error processing your request. Please try again later.", false);
            
            // Show new suggestions after error
            setTimeout(showSuggestions, 1000);
          });
        }
        
        // Function to handle sending a message
        function sendMessage() {
          const query = userInput.value.trim();
          if (query) {
            addMessage(query, true);
            userInput.value = '';
            callAgentFunction(query);
          }
        }
        
        // Handle send button click
        sendButton.addEventListener('click', sendMessage);
        
        // Handle Enter key press with modifier key support
        userInput.addEventListener('keypress', (event) => {
          if (event.key === 'Enter') {
            // Only trigger send on Enter without Shift key
            if (!event.shiftKey) {
              event.preventDefault();
              sendMessage();
            }
          }
        });
        
        // Show info modal when info button is clicked
        infoButton.addEventListener('click', () => {
          agentInfo.classList.add('active');
          agentInfoOverlay.classList.add('active');
          
          // Reset all boxes to hidden state first
          agentInfoBoxes.forEach(box => {
            box.style.opacity = 0;
            box.style.transform = 'translateY(20px)';
          });
          
          // Animate boxes sequentially
          const boxes = Array.from(agentInfoBoxes);
          boxes.forEach((box, index) => {
            setTimeout(() => {
              box.style.opacity = 1;
              box.style.transform = 'translateY(0)';
            }, 300 + (index * 200)); // 300ms initial delay, then 200ms between each box
          });
        });
        
        // Close info modal
        agentInfoClose.addEventListener('click', () => {
          agentInfo.classList.remove('active');
          agentInfoOverlay.classList.remove('active');
        });
        
        agentInfoOverlay.addEventListener('click', () => {
          agentInfo.classList.remove('active');
          agentInfoOverlay.classList.remove('active');
        });
        
        // Show intro modal for first-time visitors
        if (isFirstVisit) {
          introOverlay.classList.add('active');
          
          // Animate agent boxes in sequence
          setTimeout(() => document.getElementById('intro-user').classList.add('active'), 500);
          setTimeout(() => document.getElementById('arrow1').classList.add('active'), 1000);
          setTimeout(() => document.getElementById('intro-security').classList.add('active'), 1500);
          setTimeout(() => document.getElementById('arrow2').classList.add('active'), 2000);
          setTimeout(() => document.getElementById('intro-router').classList.add('active'), 2500);
          setTimeout(() => document.getElementById('intro-job').classList.add('active'), 3000);
          setTimeout(() => document.getElementById('intro-event').classList.add('active'), 3500);
          setTimeout(() => document.getElementById('intro-mentor').classList.add('active'), 4000);
          setTimeout(() => document.getElementById('arrow3').classList.add('active'), 4500);
          setTimeout(() => document.getElementById('intro-response').classList.add('active'), 5000);
          
          // Set a flag in localStorage to remember that the user has seen the intro
          localStorage.setItem('ashaai_visited', 'true');
        }
        
        // Close intro modal
        closeIntro.addEventListener('click', () => {
          introOverlay.classList.remove('active');
        });
        
        // Focus the input field on load
        userInput.focus();
        
        // Adjust view when virtual keyboard appears on mobile
        const viewportHeight = () => {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty('--vh', `${vh}px`);
        };
        
        window.addEventListener('resize', viewportHeight);
        viewportHeight();

        // Dark mode toggle functionality
        const themeToggle = document.getElementById('theme-toggle');
        const lightIcon = themeToggle.querySelector('.theme-light-icon');
        const darkIcon = themeToggle.querySelector('.theme-dark-icon');
        
        // Check for saved theme preference or use the system preference
        const savedTheme = localStorage.getItem('ashaai_theme');
        if (savedTheme) {
          document.documentElement.setAttribute('data-theme', savedTheme);
          updateThemeIcons(savedTheme);
        } else {
          const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          if (prefersDark) {
            document.documentElement.setAttribute('data-theme', 'dark');
            updateThemeIcons('dark');
          }
        }
        
        // Initialize particles.js
        particlesJS('particles-js', {
          "particles": {
            "number": {
              "value": 30,
              "density": {
                "enable": true,
                "value_area": 800
              }
            },
            "color": {
              "value": "#4F46E5"
            },
            "shape": {
              "type": "circle",
              "stroke": {
                "width": 0,
                "color": "#000000"
              },
              "polygon": {
                "nb_sides": 5
              }
            },
            "opacity": {
              "value": 0.3,
              "random": true,
              "anim": {
                "enable": false,
                "speed": 1,
                "opacity_min": 0.1,
                "sync": false
              }
            },
            "size": {
              "value": 5,
              "random": true,
              "anim": {
                "enable": false,
                "speed": 40,
                "size_min": 0.1,
                "sync": false
              }
            },
            "line_linked": {
              "enable": true,
              "distance": 150,
              "color": "#4F46E5",
              "opacity": 0.2,
              "width": 1
            },
            "move": {
              "enable": true,
              "speed": 2,
              "direction": "none",
              "random": false,
              "straight": false,
              "out_mode": "out",
              "bounce": false,
              "attract": {
                "enable": false,
                "rotateX": 600,
                "rotateY": 1200
              }
            }
          },
          "interactivity": {
            "detect_on": "canvas",
            "events": {
              "onhover": {
                "enable": true,
                "mode": "grab"
              },
              "onclick": {
                "enable": true,
                "mode": "push"
              },
              "resize": true
            },
            "modes": {
              "grab": {
                "distance": 140,
                "line_linked": {
                  "opacity": 0.5
                }
              },
              "bubble": {
                "distance": 400,
                "size": 40,
                "duration": 2,
                "opacity": 8,
                "speed": 3
              },
              "repulse": {
                "distance": 200,
                "duration": 0.4
              },
              "push": {
                "particles_nb": 4
              },
              "remove": {
                "particles_nb": 2
              }
            }
          },
          "retina_detect": true
        });
        
        // Update particles color based on theme
        function updateParticlesColor(theme) {
          if (theme === 'dark') {
            window.pJSDom[0].pJS.particles.color.value = '#6366F1';
            window.pJSDom[0].pJS.particles.line_linked.color = '#6366F1';
          } else {
            window.pJSDom[0].pJS.particles.color.value = '#4F46E5';
            window.pJSDom[0].pJS.particles.line_linked.color = '#4F46E5';
          }
          window.pJSDom[0].pJS.fn.particlesRefresh();
        }
        
        // Theme toggle event listener
        themeToggle.addEventListener('click', () => {
          const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          
          document.documentElement.setAttribute('data-theme', newTheme);
          localStorage.setItem('ashaai_theme', newTheme);
          updateThemeIcons(newTheme);
          updateParticlesColor(newTheme);
        });
        
        function updateThemeIcons(theme) {
          if (theme === 'dark') {
            lightIcon.style.display = 'none';
            darkIcon.style.display = 'block';
          } else {
            lightIcon.style.display = 'block';
            darkIcon.style.display = 'none';
          }
        }

        // Toggle suggestions collapse/expand
        suggestionsToggle.addEventListener('click', () => {
          suggestionsContainer.classList.toggle('collapsed');
          
          // Save preference
          const isCollapsed = suggestionsContainer.classList.contains('collapsed');
          localStorage.setItem('ashaai_suggestions_collapsed', isCollapsed ? 'true' : 'false');
        });
        
        // Check for saved suggestion collapse preference
        const savedSuggestionsCollapsed = localStorage.getItem('ashaai_suggestions_collapsed');
        if (savedSuggestionsCollapsed === 'true') {
          suggestionsContainer.classList.add('collapsed');
        }

        // Voice input functionality
        let recognition;
        
        // Check if SpeechRecognition is supported
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
          recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
          recognition.continuous = false;
          recognition.interimResults = false;
          recognition.lang = 'en-US';
          
          recognition.onresult = (event) => {
            const transcript = event.results[0][0].transcript;
            userInput.value = transcript;
            voiceButton.classList.remove('listening');
          };
          
          recognition.onend = () => {
            voiceButton.classList.remove('listening');
          };
          
          recognition.onerror = (event) => {
            voiceButton.classList.remove('listening');
            console.error('Speech recognition error', event.error);
          };
          
          // Add voice button functionality
          voiceButton.addEventListener('click', () => {
            if (voiceButton.classList.contains('listening')) {
              recognition.stop();
              voiceButton.classList.remove('listening');
            } else {
              recognition.start();
              voiceButton.classList.add('listening');
            }
          });
        } else {
          // Hide voice button if not supported
          voiceButton.style.display = 'none';
        }
      });
    </script>
  </body>
</html>
