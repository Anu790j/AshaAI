<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AshaAI Assistant</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/11.6.1/firebase-app-compat.js"></script>
    <script defer src="/__/firebase/11.6.1/firebase-auth-compat.js"></script>
    <script defer src="/__/firebase/11.6.1/firebase-functions-compat.js"></script>
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
      :root {
        --primary-color: #4F46E5;
        --primary-hover: #4338CA;
        --secondary-color: #10B981;
        --tertiary-color: #F59E0B;
        --quaternary-color: #EF4444;
        --bg-color: #F9FAFB;
        --text-color: #1F2937;
        --light-gray: #F3F4F6;
        --dark-gray: #6B7280;
        --border-radius: 16px;
        --message-radius: 18px;
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        --vh: 1vh;
      }
      
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      html, body {
        height: 100%;
        width: 100%;
        overflow: hidden;
      }
      
      body { 
        background: var(--bg-color); 
        color: var(--text-color); 
        font-family: var(--font-family);
        display: flex;
        flex-direction: column;
        transition: background-color 0.3s ease;
        position: relative;
      }
      
      header {
        background: var(--primary-color);
        color: white;
        padding: 16px;
        text-align: center;
        box-shadow: var(--shadow-md);
        position: relative;
        z-index: 10;
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      h1 {
        margin: 0;
        font-size: 20px;
        font-weight: 600;
        letter-spacing: -0.025em;
      }
      
      .info-icon {
        width: 24px;
        height: 24px;
        margin-left: 8px;
        cursor: pointer;
        opacity: 0.9;
        transition: all 0.2s ease;
      }
      
      .info-icon:hover {
        opacity: 1;
        transform: scale(1.1);
      }
      
      .chat-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        max-width: 100%;
        margin: 0 auto;
        position: relative;
        height: calc(100% - 60px);
        width: 100%;
        max-width: 768px;
        padding: 0 16px;
      }
      
      .messages-wrapper {
        flex: 1;
        overflow: hidden;
        position: relative;
        padding: 16px 0;
      }
      
      .messages {
        height: 100%;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 16px;
        padding-right: 8px;
        scroll-behavior: smooth;
      }
      
      .messages::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      
      .messages::-webkit-scrollbar-track {
        background: transparent;
      }
      
      .messages::-webkit-scrollbar-thumb {
        background: var(--dark-gray);
        border-radius: 10px;
        opacity: 0.5;
      }
      
      .message {
        max-width: 85%;
        padding: 12px 16px;
        border-radius: var(--message-radius);
        line-height: 1.5;
        word-wrap: break-word;
        animation: fadeIn 0.3s ease;
        font-size: 0.95rem;
      }
      
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      
      .user-message {
        align-self: flex-end;
        background: var(--primary-color);
        color: white;
        border-radius: var(--message-radius) var(--message-radius) 0 var(--message-radius);
        box-shadow: var(--shadow-sm);
      }
      
      .bot-message {
        align-self: flex-start;
        background: white;
        color: var(--text-color);
        border-radius: 0 var(--message-radius) var(--message-radius) var(--message-radius);
        box-shadow: var(--shadow-sm);
      }
      
      .bot-message:first-child {
        border-radius: var(--message-radius);
      }
      
      .input-container {
        position: relative;
        padding: 16px 0 24px 0;
        background: linear-gradient(to top, var(--bg-color) 80%, transparent);
      }
      
      .input-area {
        display: flex;
        align-items: center;
        padding: 4px 8px 4px 16px;
        background: white;
        border-radius: 24px;
        box-shadow: var(--shadow-md);
        transition: box-shadow 0.3s ease;
      }
      
      .input-area:focus-within {
        box-shadow: 0 0 0 2px var(--primary-color), var(--shadow-md);
      }
      
      #user-input {
        flex: 1;
        border: none;
        outline: none;
        padding: 12px 0;
        font-size: 16px;
        font-family: inherit;
        background: transparent;
        color: var(--text-color);
      }
      
      #user-input::placeholder {
        color: var(--dark-gray);
        opacity: 0.7;
      }
      
      #send-button {
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        margin-left: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        outline: none;
      }
      
      #send-button:hover, #send-button:focus {
        background: var(--primary-hover);
        transform: scale(1.05);
      }
      
      #send-button:active {
        transform: scale(0.95);
      }
      
      .thinking {
        align-self: flex-start;
        background: var(--light-gray);
        color: var(--dark-gray);
        padding: 12px 16px;
        border-radius: 18px;
        display: none;
        font-size: 0.95rem;
      }
      
      .thinking.active {
        display: flex;
        align-items: center;
        animation: fadeIn 0.3s ease;
      }
      
      .dot-flashing {
        position: relative;
        width: 6px;
        height: 6px;
        border-radius: 5px;
        background-color: var(--dark-gray);
        color: var(--dark-gray);
        animation: dot-flashing 1s infinite linear alternate;
        animation-delay: 0.5s;
        margin: 0 0 0 8px;
      }
      
      .dot-flashing::before, .dot-flashing::after {
        content: '';
        display: inline-block;
        position: absolute;
        top: 0;
      }
      
      .dot-flashing::before {
        left: -10px;
        width: 6px;
        height: 6px;
        border-radius: 5px;
        background-color: var(--dark-gray);
        color: var(--dark-gray);
        animation: dot-flashing 1s infinite alternate;
        animation-delay: 0s;
      }
      
      .dot-flashing::after {
        left: 10px;
        width: 6px;
        height: 6px;
        border-radius: 5px;
        background-color: var(--dark-gray);
        color: var(--dark-gray);
        animation: dot-flashing 1s infinite alternate;
        animation-delay: 1s;
      }
      
      @keyframes dot-flashing {
        0% {
          background-color: var(--dark-gray);
        }
        50%, 100% {
          background-color: rgba(107, 114, 128, 0.2);
        }
      }
      
      /* Intro modal styles */
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .overlay.active {
        opacity: 1;
        visibility: visible;
      }
      
      .intro-modal {
        background: white;
        border-radius: var(--border-radius);
        padding: 24px;
        max-width: 90%;
        width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: var(--shadow-lg);
        position: relative;
        transform: translateY(20px);
        opacity: 0;
        transition: all 0.4s ease;
      }
      
      .overlay.active .intro-modal {
        transform: translateY(0);
        opacity: 1;
      }
      
      .modal-header {
        margin-bottom: 20px;
        text-align: center;
      }
      
      .modal-header h2 {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary-color);
        margin-bottom: 8px;
      }
      
      .modal-header p {
        color: var(--dark-gray);
        font-size: 0.95rem;
      }
      
      .modal-content {
        margin-bottom: 24px;
      }
      
      .agent-diagram {
        width: 100%;
        padding: 20px;
        position: relative;
        margin: 20px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      
      .agent-box {
        background: white;
        padding: 12px 16px;
        border-radius: 12px;
        box-shadow: var(--shadow-md);
        margin: 10px;
        text-align: center;
        width: 80%;
        max-width: 300px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
      }
      
      .agent-box.active {
        opacity: 1;
        transform: translateY(0);
      }
      
      .agent-box h3 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 6px;
      }
      
      .agent-box p {
        font-size: 14px;
        color: var(--dark-gray);
      }
      
      .agent-diagram-main {
        display: flex;
        width: 100%;
        justify-content: space-between;
        margin: 20px 0;
      }
      
      .agent-arrow {
        position: absolute;
        width: 40px;
        height: 20px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease;
      }
      
      .agent-arrow.active {
        opacity: 1;
        transform: translateY(0);
      }
      
      .close-modal {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 500;
        cursor: pointer;
        display: block;
        margin: 0 auto;
        transition: all 0.2s ease;
      }
      
      .close-modal:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
      }
      
      .close-modal:active {
        transform: translateY(0);
      }
      
      /* Agent info tooltip */
      .agent-info {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.9);
        background: white;
        padding: 20px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-lg);
        z-index: 100;
        max-width: 90%;
        width: 500px;
        max-height: 80vh;
        overflow-y: auto;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .agent-info.active {
        opacity: 1;
        visibility: visible;
        transform: translate(-50%, -50%) scale(1);
      }
      
      .agent-info-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 99;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
      }
      
      .agent-info-overlay.active {
        opacity: 1;
        visibility: visible;
      }
      
      .agent-info h3 {
        color: var(--primary-color);
        margin-bottom: 12px;
        font-size: 20px;
      }
      
      .agent-info-close {
        position: absolute;
        top: 10px;
        right: 10px;
        background: none;
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: var(--dark-gray);
      }
      
      /* Agent info specific styles */
      .agent-info .agent-diagram {
        padding: 10px 0;
        margin: 10px 0;
      }
      
      .agent-info .agent-box {
        padding: 8px 12px;
        margin: 6px auto;
        width: 90%;
      }
      
      .agent-info .agent-box h3 {
        font-size: 14px;
        margin-bottom: 4px;
      }
      
      .agent-info .agent-box p {
        font-size: 12px;
        margin: 0;
      }
      
      .agent-info .agent-diagram-main {
        flex-wrap: wrap;
        justify-content: center;
        gap: 5px;
        margin: 10px 0;
      }
      
      .agent-info .agent-diagram-main .agent-box {
        width: 45%;
        min-width: 120px;
      }
      
      /* Responsive adjustments */
      @media (max-width: 640px) {
        .chat-container {
          padding: 0 12px;
        }
        
        .message {
          max-width: 90%;
          font-size: 0.9rem;
        }
        
        h1 {
          font-size: 18px;
        }
        
        .messages-wrapper {
          padding: 12px 0;
        }
        
        .input-area {
          padding: 2px 4px 2px 12px;
        }
        
        #user-input {
          padding: 10px 0;
          font-size: 15px;
        }
        
        .agent-diagram-main {
          flex-direction: column;
          align-items: center;
        }
        
        .agent-info {
          max-height: 80vh;
          width: 95%;
          overflow-y: auto;
        }
        
        .agent-box {
          width: 90%;
          margin: 8px auto;
        }
      }
      
      @media (min-width: 1024px) {
        .chat-container {
          max-width: 800px;
        }
        
        .message {
          max-width: 75%;
        }
        
        .agent-info {
          max-height: 85vh;
          width: 450px;
          overflow-y: auto;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1>AshaAI Assistant</h1>
      <div class="info-icon" id="info-button">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white" width="24" height="24">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
        </svg>
      </div>
    </header>
    
    <div class="chat-container">
      <div class="messages-wrapper">
        <div class="messages" id="messages">
          <div class="message bot-message">
            Hello! I'm AshaAI. How can I help you today?
          </div>
        </div>
      </div>
      
      <div class="thinking" id="thinking">
        <span>AshaAI is thinking</span>
        <div class="dot-flashing"></div>
      </div>
      
      <div class="input-container">
        <div class="input-area">
          <input type="text" id="user-input" placeholder="Type your message here..." />
          <button id="send-button" aria-label="Send message">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.01 21L23 12 2.01 3 2 10L17 12 2 14L2.01 21Z" fill="white"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Agent Information Overlay -->
    <div class="agent-info-overlay" id="agent-info-overlay"></div>
    <div class="agent-info" id="agent-info">
      <button class="agent-info-close" id="agent-info-close">&times;</button>
      <h3>AshaAI Architecture</h3>
      <p>AshaAI uses an advanced multi-agent architecture powered by Google ADK and Gemini:</p>
      <div class="agent-diagram">
        <div class="agent-box" style="background-color: #F3F4F6;">
          <h3>User Input</h3>
          <p>Your messages and requests</p>
        </div>
        <div class="agent-box" style="background-color: #E0F2FE;">
          <h3>Security Agent</h3>
          <p>Checks for security issues, bias, or sensitive content</p>
        </div>
        <div class="agent-box" style="background-color: #DBEAFE;">
          <h3>Router Agent</h3>
          <p>Decides which specialized agent to use based on your query</p>
        </div>
        <div class="agent-diagram-main">
          <div class="agent-box" style="background-color: #E0F2FE;">
            <h3>Job Search Agent</h3>
            <p>Finds job listings using local DB and web searches</p>
          </div>
          <div class="agent-box" style="background-color: #FEF3C7;">
            <h3>Event Search Agent</h3>
            <p>Searches for relevant events and meetups</p>
          </div>
          <div class="agent-box" style="background-color: #E0F2FE;">
            <h3>Mentorship Search Agent</h3>
            <p>Finds mentorship opportunities</p>
          </div>
        </div>
        <div class="agent-box" style="background-color: #DBEAFE;">
          <h3>Response</h3>
          <p>The final answer crafted for you</p>
        </div>
      </div>
      <p>This workflow is built with Google ADK and Gemini to deliver accurate, helpful responses to your questions.</p>
    </div>

    <!-- Introduction Modal -->
    <div class="overlay" id="intro-overlay">
      <div class="intro-modal">
        <div class="modal-header">
          <h2>Welcome to AshaAI</h2>
          <p>Your intelligent assistant powered by advanced AI technology</p>
        </div>
        <div class="modal-content">
          <p>AshaAI is built using a multi-agent architecture that allows it to handle a variety of tasks efficiently.</p>
          
          <div class="agent-diagram">
            <div class="agent-box" id="intro-user">
              <h3>User Input</h3>
              <p>Your messages and requests</p>
            </div>
            
            <svg class="agent-arrow" id="arrow1" width="20" height="40" viewBox="0 0 20 40" fill="none" xmlns="http://www.w3.org/2000/svg" style="top: 80px; left: 50%; transform: translateX(-50%);">
              <path d="M10 0L10 35M10 35L1 26M10 35L19 26" stroke="#6B7280" stroke-width="2"/>
            </svg>
            
            <div class="agent-box" id="intro-security" style="background-color: #E0F2FE;">
              <h3>Security Agent</h3>
              <p>Checks for security issues, bias, or sensitive content</p>
            </div>
            
            <svg class="agent-arrow" id="arrow2" width="20" height="40" viewBox="0 0 20 40" fill="none" xmlns="http://www.w3.org/2000/svg" style="top: 180px; left: 50%; transform: translateX(-50%);">
              <path d="M10 0L10 35M10 35L1 26M10 35L19 26" stroke="#6B7280" stroke-width="2"/>
            </svg>
            
            <div class="agent-box" id="intro-router" style="background-color: #DBEAFE;">
              <h3>Router Agent</h3>
              <p>Decides which specialized agent to use based on your query</p>
            </div>
            
            <div class="agent-diagram-main" id="specialized-agents">
              <div class="agent-box" id="intro-job" style="background-color: #E0F2FE;">
                <h3>Job Search Agent</h3>
                <p>Finds job listings using local DB and web searches</p>
              </div>
              
              <div class="agent-box" id="intro-event" style="background-color: #FEF3C7;">
                <h3>Event Search Agent</h3>
                <p>Searches for relevant events and meetups</p>
              </div>
              
              <div class="agent-box" id="intro-mentor" style="background-color: #E0F2FE;">
                <h3>Mentorship Search Agent</h3>
                <p>Finds mentorship opportunities</p>
              </div>
            </div>
            
            <svg class="agent-arrow" id="arrow3" width="20" height="40" viewBox="0 0 20 40" fill="none" xmlns="http://www.w3.org/2000/svg" style="bottom: 100px; left: 50%; transform: translateX(-50%);">
              <path d="M10 0L10 35M10 35L1 26M10 35L19 26" stroke="#6B7280" stroke-width="2"/>
            </svg>
            
            <div class="agent-box" id="intro-response" style="background-color: #DBEAFE;">
              <h3>Response</h3>
              <p>The final answer crafted for you</p>
            </div>
          </div>
          
          <p>This workflow is built with Google ADK and Gemini to deliver accurate, helpful responses to your questions.</p>
        </div>
        <button class="close-modal" id="close-intro">Got it!</button>
      </div>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const messagesContainer = document.getElementById('messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const thinking = document.getElementById('thinking');
        const introOverlay = document.getElementById('intro-overlay');
        const closeIntro = document.getElementById('close-intro');
        const infoButton = document.getElementById('info-button');
        const agentInfo = document.getElementById('agent-info');
        const agentInfoOverlay = document.getElementById('agent-info-overlay');
        const agentInfoClose = document.getElementById('agent-info-close');
        
        // Fix for agent-info - make sure all boxed are visible
        const agentInfoBoxes = agentInfo.querySelectorAll('.agent-box');
        agentInfoBoxes.forEach(box => {
          box.style.opacity = 1;
          box.style.transform = 'translateY(0)';
        });
        
        // Common queries database - respond locally without backend call
        const commonResponses = {
          "hi": "Hello! I'm AshaAI. How can I help you today?",
          "hello": "Hi there! I'm AshaAI, your AI assistant. What can I do for you?",
          "hey": "Hey! I'm AshaAI. What can I help you with today?",
          "who are you": "I'm AshaAI, an intelligent assistant powered by Google ADK and Gemini. I can help with searches, answer questions, and perform calculations. My architecture uses a multi-agent system that routes your questions to specialized sub-agents for the best response.",
          "what is your name": "My name is AshaAI. I'm your AI assistant designed to help with various tasks!",
          "what can you do": "I can help with several things using my multi-agent architecture: search for information on the web, answer general knowledge questions, make calculations, and have conversations. Just ask me anything, and I'll do my best to assist you!",
          "how do you work": "I work using a sophisticated multi-agent architecture powered by Google ADK and Gemini. When you ask a question, my coordinator agent routes it to specialized sub-agents: a greeter for conversations, a search agent for factual information, or a calculator agent for math problems. This helps me provide accurate and helpful responses.",
          "what's your purpose": "My purpose is to assist you with finding information, answering questions, and having helpful conversations. I'm designed to be your AI companion for knowledge and assistance.",
          "help": "I can help you find information, answer questions, or just chat. Try asking me about a topic you're interested in, or ask me to calculate something for you.",
          "thanks": "You're welcome! If you need anything else, just ask.",
          "thank you": "You're welcome! I'm happy to help.",
        };
        
        // Function to find the best matching response from common queries
        function findBestResponse(query) {
          // Normalize the query
          const normalizedQuery = query.toLowerCase().trim();
          
          // Direct match
          if (commonResponses[normalizedQuery]) {
            return commonResponses[normalizedQuery];
          }
          
          // Partial match - check if query contains any of the keys
          for (const [key, response] of Object.entries(commonResponses)) {
            if (normalizedQuery.includes(key) || key.includes(normalizedQuery)) {
              return response;
            }
          }
          
          // No match found
          return null;
        }
        
        // Check if this is the first visit
        const isFirstVisit = !localStorage.getItem('ashaai_visited');
        
        // Function to add a message to the chat
        function addMessage(text, isUser) {
          const messageDiv = document.createElement('div');
          messageDiv.className = isUser ? 'message user-message' : 'message bot-message';
          messageDiv.textContent = text;
          messagesContainer.appendChild(messageDiv);
          scrollToBottom();
        }
        
        // Function to scroll to the bottom of the messages
        function scrollToBottom() {
          setTimeout(() => {
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
          }, 50);
        }
        
        // Function to call the Firebase function
        function callAgentFunction(query) {
          // Check if we have a local response for this query
          const localResponse = findBestResponse(query);
          
          if (localResponse) {
            // Simulate thinking for a short time to make it feel natural
            thinking.classList.add('active');
            scrollToBottom();
            
            setTimeout(() => {
              thinking.classList.remove('active');
              addMessage(localResponse, false);
            }, 600 + Math.random() * 1000); // Random delay between 600-1600ms for natural feel
            
            return;
          }
          
          // If no local response, proceed with backend call
          thinking.classList.add('active');
          scrollToBottom();
          
          // Always use the production URL
          fetch('https://us-central1-ashaai-2dd79.cloudfunctions.net/ashaaI2_agent', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ query: query })
          })
          .then(response => response.json())
          .then(data => {
            // Hide typing indicator
            thinking.classList.remove('active');
            
            // Add the response from the agent to the chat
            const response = data.response || data;
            addMessage(response, false);
          })
          .catch(error => {
            // Hide typing indicator
            thinking.classList.remove('active');
            console.error(error);
            addMessage("Sorry, there was an error processing your request. Please try again later.", false);
          });
        }
        
        // Function to handle sending a message
        function sendMessage() {
          const query = userInput.value.trim();
          if (query) {
            addMessage(query, true);
            userInput.value = '';
            callAgentFunction(query);
          }
        }
        
        // Handle send button click
        sendButton.addEventListener('click', sendMessage);
        
        // Handle Enter key press
        userInput.addEventListener('keypress', (event) => {
          if (event.key === 'Enter') {
            sendMessage();
          }
        });
        
        // Show info modal when info button is clicked
        infoButton.addEventListener('click', () => {
          agentInfo.classList.add('active');
          agentInfoOverlay.classList.add('active');
          
          // Reset all boxes to hidden state first
          agentInfoBoxes.forEach(box => {
            box.style.opacity = 0;
            box.style.transform = 'translateY(20px)';
          });
          
          // Animate boxes sequentially
          const boxes = Array.from(agentInfoBoxes);
          boxes.forEach((box, index) => {
            setTimeout(() => {
              box.style.opacity = 1;
              box.style.transform = 'translateY(0)';
            }, 300 + (index * 200)); // 300ms initial delay, then 200ms between each box
          });
        });
        
        // Close info modal
        agentInfoClose.addEventListener('click', () => {
          agentInfo.classList.remove('active');
          agentInfoOverlay.classList.remove('active');
        });
        
        agentInfoOverlay.addEventListener('click', () => {
          agentInfo.classList.remove('active');
          agentInfoOverlay.classList.remove('active');
        });
        
        // Show intro modal for first-time visitors
        if (isFirstVisit) {
          introOverlay.classList.add('active');
          
          // Animate agent boxes in sequence
          setTimeout(() => document.getElementById('intro-user').classList.add('active'), 500);
          setTimeout(() => document.getElementById('arrow1').classList.add('active'), 1000);
          setTimeout(() => document.getElementById('intro-security').classList.add('active'), 1500);
          setTimeout(() => document.getElementById('arrow2').classList.add('active'), 2000);
          setTimeout(() => document.getElementById('intro-router').classList.add('active'), 2500);
          setTimeout(() => document.getElementById('intro-job').classList.add('active'), 3000);
          setTimeout(() => document.getElementById('intro-event').classList.add('active'), 3500);
          setTimeout(() => document.getElementById('intro-mentor').classList.add('active'), 4000);
          setTimeout(() => document.getElementById('arrow3').classList.add('active'), 4500);
          setTimeout(() => document.getElementById('intro-response').classList.add('active'), 5000);
          
          // Set a flag in localStorage to remember that the user has seen the intro
          localStorage.setItem('ashaai_visited', 'true');
        }
        
        // Close intro modal
        closeIntro.addEventListener('click', () => {
          introOverlay.classList.remove('active');
        });
        
        // Focus the input field on load
        userInput.focus();
        
        // Adjust view when virtual keyboard appears on mobile
        const viewportHeight = () => {
          const vh = window.innerHeight * 0.01;
          document.documentElement.style.setProperty('--vh', `${vh}px`);
        };
        
        window.addEventListener('resize', viewportHeight);
        viewportHeight();
      });
    </script>
  </body>
</html>
